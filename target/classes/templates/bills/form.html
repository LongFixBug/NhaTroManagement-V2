<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
    th:replace="~{fragments/_layout :: html(pageTitle=${pageTitle}, content=~{::content})}" lang="en">

<th:block th:fragment="content">
    <h2 th:text="${pageTitle}">Page Title</h2>

    <form th:action="@{/bills/save}" th:object="${bill}" method="post" class="needs-validation" novalidate>
        <!-- Hidden field for tenant ID -->
        <input type="hidden" th:field="*{tenant.id}" />
        <!-- Hidden field for Bill ID (only in edit mode) -->
        <input type="hidden" th:if="${isEditMode}" th:field="*{id}" />

        <div class="row g-3">
            <div class="col-md-6 mb-3">
                <label for="billMonth" class="form-label" th:text="#{bill.form.billingMonth}">Billing Month:</label>
                <input type="number" th:field="*{billMonth}" class="form-control" id="billMonth" required min="1"
                    max="12" th:readonly="${isEditMode}" />
                <div class="invalid-feedback" th:text="#{bill.form.error.billingMonth}">Please provide a valid month
                    (1-12).</div>
            </div>
            <div class="col-md-6 mb-3">
                <label for="billYear" class="form-label" th:text="#{bill.form.billingYear}">Billing Year:</label>
                <input type="number" th:field="*{billYear}" class="form-control" id="billYear" required min="2000"
                    max="2100" th:readonly="${isEditMode}" />
                <div class="invalid-feedback" th:text="#{bill.form.error.billingYear}">Please provide a valid year.
                </div>
            </div>
        </div>

        <div class="row g-3">
            <div class="col-md-12 mb-3">
                <label for="occupantName" class="form-label" th:text="#{bill.form.occupantName}">Occupant Name:</label>
                <input type="text" th:field="*{occupantName}" class="form-control" id="occupantName" required />
                <div class="invalid-feedback" th:text="#{bill.form.error.occupantName}">Please provide the occupant's
                    name.</div>
            </div>
        </div>

        <h5 class="mt-4" th:text="#{bill.form.meterReadings}">Meter Readings</h5>
        <div class="row g-3">
            <div class="col-md-6 mb-3">
                <label for="electricityKwhPrevious" class="form-label"
                    th:text="#{bill.form.electricityKwhPrevious}">Previous Electricity (kWh):</label>
                <input type="number" th:field="*{electricityKwhPrevious}" class="form-control"
                    id="electricityKwhPrevious" readonly />
            </div>
            <div class="col-md-6 mb-3">
                <label for="electricityKwhCurrent" class="form-label"
                    th:text="#{bill.form.electricityKwhCurrent}">Current Electricity (kWh):</label>
                <input type="number" step="0.1" name="electricityKwhCurrent"
                    th:value="${bill.electricityKwhCurrent > 0 ? bill.electricityKwhCurrent : ''}" class="form-control"
                    id="electricityKwhCurrent" required min="0" th:placeholder="#{bill.form.placeholder.enter}" />
                <div th:if="*{electricityKwhCurrent < electricityKwhPrevious}" class="text-danger small"
                    th:text="#{bill.form.error.readingOrder}">Current reading should be >= previous reading.</div>
                <div class="invalid-feedback" th:text="#{bill.form.error.electricityKwhCurrent}">Please provide current
                    electricity reading.</div>
            </div>
        </div>
        <div class="row g-3">
            <div class="col-md-6 mb-3">
                <label for="waterM3Previous" class="form-label" th:text="#{bill.form.waterM3Previous}">Previous Water
                    (m³):</label>
                <input type="number" th:field="*{waterM3Previous}" class="form-control" id="waterM3Previous" readonly />
            </div>
            <div class="col-md-6 mb-3">
                <label for="waterM3Current" class="form-label" th:text="#{bill.form.waterM3Current}">Current Water
                    (m³):</label>
                <input type="number" step="0.1" name="waterM3Current"
                    th:value="${bill.waterM3Current > 0 ? bill.waterM3Current : ''}" class="form-control"
                    id="waterM3Current" required min="0" th:placeholder="#{bill.form.placeholder.enter}" />
                <div th:if="*{waterM3Current < waterM3Previous}" class="text-danger small"
                    th:text="#{bill.form.error.readingOrder}">Current reading should be >= previous reading.</div>
                <div class="invalid-feedback" th:text="#{bill.form.error.waterM3Current}">Please provide current water
                    reading.</div>
            </div>
        </div>

        <h5 class="mt-4" th:text="#{bill.form.otherFees} + ' (' + #{currency.vnd} + ')'">Other Fees (VND)</h5>
        <div class="row g-3">
            <div class="col-md-4 mb-3">
                <label for="roomRent" class="form-label" th:text="#{bill.form.roomRent}">Room Rent:</label>
                <input type="number" step="1000" name="roomRent" th:value="${bill.roomRent}" class="form-control"
                    id="roomRent" required min="0" th:placeholder="#{bill.form.placeholder.roomRent}" />
                <div class="invalid-feedback" th:text="#{bill.form.error.roomRent}">Please provide room rent.</div>
            </div>
            <div class="col-md-4 mb-3">
                <label for="trashFee" class="form-label" th:text="#{bill.form.trashFee}">Trash Fee:</label>
                <input type="number" step="1000" name="trashFee" th:value="${bill.trashFee}" class="form-control"
                    id="trashFee" required min="0" th:placeholder="#{bill.form.placeholder.trashFee}" />
                <div class="invalid-feedback" th:text="#{bill.form.error.trashFee}">Please provide trash fee.</div>
            </div>
            <div class="col-md-4 mb-3">
                <label for="wifiFee" class="form-label" th:text="#{bill.form.wifiFee}">WiFi Fee:</label>
                <input type="number" step="1000" name="wifiFee" th:value="${bill.wifiFee}" class="form-control"
                    id="wifiFee" required min="0" th:placeholder="#{bill.form.placeholder.wifiFee}" />
                <div class="invalid-feedback" th:text="#{bill.form.error.wifiFee}">Please provide WiFi fee.</div>
            </div>
        </div>

        <div class="mt-4">
            <button type="submit" class="btn btn-primary"
                th:text="${isEditMode} ? #{button.save.changes} : #{button.create.bill}">
                Save
            </button>
            <a th:href="@{/bills/tenant/{tenantId}(tenantId=*{tenant.id})}" class="btn btn-secondary"
                th:text="#{button.cancel}">Cancel</a>
        </div>
    </form>

    <script>
        // Example starter JavaScript for disabling form submissions if there are invalid fields
        (function () {
            'use strict'
            var forms = document.querySelectorAll('.needs-validation')
            Array.prototype.slice.call(forms)
                .forEach(function (form) {
                    form.addEventListener('submit', function (event) {
                        if (!form.checkValidity()) {
                            event.preventDefault()
                            event.stopPropagation()
                        }
                        form.classList.add('was-validated')
                    }, false)
                })
        })()
    </script>

</th:block>

</html>